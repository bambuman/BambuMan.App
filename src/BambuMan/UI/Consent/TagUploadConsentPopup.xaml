<?xml version="1.0" encoding="utf-8" ?>
<toolkit:Popup xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
               xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
               xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
               xmlns:m="clr-namespace:UraniumUI.Icons.MaterialSymbols;assembly=UraniumUI.Icons.MaterialSymbols"
               x:Class="BambuMan.UI.Consent.TagUploadConsentPopup"
               x:TypeArguments="x:Boolean"
               BackgroundColor="{AppThemeBinding Light={StaticResource PopupBackground}, Dark={StaticResource PopupBackgroundDark}}">

    <VerticalStackLayout Padding="0" Spacing="12" WidthRequest="340">

        <!-- Title with Icon -->
        <HorizontalStackLayout HorizontalOptions="Start" Spacing="8">
            <Image HeightRequest="38" VerticalOptions="Center">
                <Image.Source>
                    <FontImageSource FontFamily="MaterialSharp"
                                     Glyph="{x:Static m:MaterialSharp.Science}"
                                     Color="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
                                     Size="38" />
                </Image.Source>
            </Image>
            <Label Text="Research Data Contribution"
                   FontAttributes="Bold"
                   FontSize="20"
                   VerticalOptions="Center"
                   TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}" />
        </HorizontalStackLayout>

        <!-- Description -->
        <Label FontSize="15"
               HorizontalTextAlignment="Start"
               TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray300}}">
            <Label.FormattedText>
                <FormattedString>
                    <Span Text="Help improve Bambu Lab filament research by uploading NFC tag data to the "></Span>
                    <Span Text="Bambu-Lab-RFID-Library" TextColor="{AppThemeBinding Light={StaticResource LinkText}, Dark={StaticResource LinkTextDark}}" TextDecorations="Underline">
                        <Span.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnLibraryLinkTapped" />
                        </Span.GestureRecognizers>
                    </Span>
                    <Span Text="."></Span>
                </FormattedString>
            </Label.FormattedText>
        </Label>

        <!-- Batch download info -->
        <Label FontSize="15"
               HorizontalTextAlignment="Start"
               TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray300}}">
            <Label.FormattedText>
                <FormattedString>
                    <Span Text="The uploaded data will also be available at "></Span>
                    <Span Text="bambuman.ee" TextColor="{AppThemeBinding Light={StaticResource LinkText}, Dark={StaticResource LinkTextDark}}" TextDecorations="Underline">
                        <Span.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnBambuManLinkTapped" />
                        </Span.GestureRecognizers>
                    </Span>
                    <Span Text=" as a downloadable archive."></Span>
                </FormattedString>
            </Label.FormattedText>
        </Label>

        <!-- What is uploaded section -->
        <Border Stroke="{AppThemeBinding Light={StaticResource Gray300}, Dark={StaticResource Gray600}}"
                StrokeThickness="1"
                StrokeShape="RoundRectangle 5"
                Padding="10"
                BackgroundColor="{AppThemeBinding Light={StaticResource Gray100}, Dark={StaticResource Gray900}}">
            <VerticalStackLayout Spacing="4">
                <Label FontSize="15" TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource Gray200}}">
                    <Label.FormattedText>
                        <FormattedString>
                            <Span Text="What is uploaded: "></Span>
                            <Span Text="Full NFC tag data with keys" FontAttributes="Bold"></Span>
                            <Span Text="."></Span>
                        </FormattedString>
                    </Label.FormattedText>
                </Label>
            </VerticalStackLayout>
        </Border>

        <!-- Warning - public data -->
        <Border Stroke="{AppThemeBinding Light={StaticResource WarningBannerStroke}, Dark={StaticResource WarningBannerStrokeDark}}"
                StrokeThickness="1"
                StrokeShape="RoundRectangle 5"
                Padding="10"
                BackgroundColor="{AppThemeBinding Light={StaticResource WarningBannerBackground}, Dark={StaticResource WarningBannerBackgroundDark}}">
            <Grid ColumnDefinitions="Auto,*" ColumnSpacing="8">
                <Image Grid.Column="0" HeightRequest="26" VerticalOptions="Start">
                    <Image.Source>
                        <FontImageSource FontFamily="MaterialSharp"
                                         Glyph="{x:Static m:MaterialSharp.Warning}"
                                         Color="{AppThemeBinding Light={StaticResource WarningBannerIcon}, Dark={StaticResource WarningBannerIconDark}}"
                                         Size="26" />
                    </Image.Source>
                </Image>
                <Label Grid.Column="1"
                       Text="The uploaded data will be PUBLIC and published under MIT license."
                       FontSize="15"
                       TextColor="{AppThemeBinding Light={StaticResource WarningBannerText}, Dark={StaticResource WarningBannerTextDark}}"
                       VerticalOptions="Center" />
            </Grid>
        </Border>

        <!-- Info section -->
        <Border Stroke="{AppThemeBinding Light={StaticResource CautionBannerStroke}, Dark={StaticResource CautionBannerStrokeDark}}"
                StrokeThickness="1"
                StrokeShape="RoundRectangle 5"
                Padding="10"
                BackgroundColor="{AppThemeBinding Light={StaticResource CautionBannerBackground}, Dark={StaticResource CautionBannerBackgroundDark}}">
            <Grid ColumnDefinitions="Auto,*" ColumnSpacing="8">
                <Image Grid.Column="0" HeightRequest="26" VerticalOptions="Start">
                    <Image.Source>
                        <FontImageSource FontFamily="MaterialSharp"
                                         Glyph="{x:Static m:MaterialSharp.Info}"
                                         Color="{AppThemeBinding Light={StaticResource CautionBannerIcon}, Dark={StaticResource CautionBannerIconDark}}"
                                         Size="26" />
                    </Image.Source>
                </Image>
                <VerticalStackLayout Grid.Column="1" Spacing="4">
                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="6">
                        <Label Grid.Column="0" Text="&#x2022;" FontSize="12" TextColor="{AppThemeBinding Light={StaticResource CautionBannerText}, Dark={StaticResource CautionBannerTextDark}}" VerticalOptions="Start" />
                        <Label Grid.Column="1" Text="Please scan both sides of the spool â€” each tag contains unique data."
                               FontSize="15"
                               TextColor="{AppThemeBinding Light={StaticResource CautionBannerText}, Dark={StaticResource CautionBannerTextDark}}" />
                    </Grid>
                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="6">
                        <Label Grid.Column="0" Text="&#x2022;" FontSize="12" TextColor="{AppThemeBinding Light={StaticResource CautionBannerText}, Dark={StaticResource CautionBannerTextDark}}" VerticalOptions="Start" />
                        <Label Grid.Column="1" Text="Limited to 1000 tag uploads per day."
                               FontSize="15"
                               TextColor="{AppThemeBinding Light={StaticResource CautionBannerText}, Dark={StaticResource CautionBannerTextDark}}" />
                    </Grid>
                </VerticalStackLayout>
            </Grid>
        </Border>

        <!-- Settings note -->
        <HorizontalStackLayout HorizontalOptions="Center" Spacing="6">
            <Image HeightRequest="20" Margin="0,2,0,0" VerticalOptions="Center">
                <Image.Source>
                    <FontImageSource FontFamily="MaterialSharp"
                                     Glyph="{x:Static m:MaterialSharp.Settings}"
                                     Color="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}"
                                     Size="20" />
                </Image.Source>
            </Image>
            <Label Text="You can opt out anytime in Settings."
                   FontSize="15"
                   VerticalOptions="Center"
                   TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}" />
        </HorizontalStackLayout>

        <!-- Buttons -->
        <Grid ColumnDefinitions="*,*" ColumnSpacing="10" Margin="0,8,0,0">
            <Button Grid.Column="0"
                    Text="No Thanks"
                    BackgroundColor="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}"
                    TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource Gray200}}"
                    Clicked="OnDeclineClicked" />
            <Button Grid.Column="1"
                    Text="Participate"
                    BackgroundColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
                    TextColor="{AppThemeBinding Light=White, Dark={StaticResource PrimaryDarkText}}"
                    Clicked="OnAcceptClicked" />
        </Grid>

    </VerticalStackLayout>
</toolkit:Popup>
